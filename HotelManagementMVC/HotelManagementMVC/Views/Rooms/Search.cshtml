@model HotelManagementMVC.Models.SearchRoomsViewModel

@{
    ViewData["Title"] = "Tìm Phòng";
}

<div class="row justify-content-center">
    <div class="col-md-8">
        <h2 class="mb-4 text-center">Tìm Phòng Sẵn Có</h2>

        <div class="card shadow-sm mb-4">
            <div class="card-body">
                <form asp-action="Search" method="post">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label asp-for="CheckIn" class="form-label">Ngày Nhận Phòng</label>
                            <input asp-for="CheckIn" class="form-control" type="date" />
                            <span asp-validation-for="CheckIn" class="text-danger"></span>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label asp-for="CheckOut" class="form-label">Ngày Trả Phòng</label>
                            <input asp-for="CheckOut" class="form-control" type="date" />
                            <span asp-validation-for="CheckOut" class="text-danger"></span>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label asp-for="RoomTypeId" class="form-label">Loại Phòng (Tùy Chọn)</label>
                            <select asp-for="RoomTypeId" asp-items="Model.RoomTypes" class="form-select">
                                <option value="">-- Tất Cả Loại Phòng --</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label asp-for="RoomNumber" class="form-label">Số Phòng (Tùy Chọn)</label>
                            <input asp-for="RoomNumber" class="form-control" placeholder="Ví dụ: 101" />
                        </div>
                    </div>

                    @if (!ViewData.ModelState.IsValid)
                    {
                        <div class="alert alert-danger">
                            <ul class="mb-0 ps-3">
                                @foreach (var err in ViewData.ModelState.Values.SelectMany(v => v.Errors))
                                {
                                    <li>@err.ErrorMessage</li>
                                }
                            </ul>
                        </div>
                    }

                    <div class="d-grid mt-3">
                        <button type="submit" class="btn btn-primary btn-lg">Tìm Phòng Sẵn Có</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

@if (Model.Results != null && Model.Results.Count > 0)
{
    <div class="search-results-section">
        <div class="results-header">
            <h2 class="results-title">
                <i class="fas fa-door-open"></i> Các Phòng Sẵn Có
            </h2>
            <span class="results-count">@Model.Results.Count phòng</span>
        </div>

        <div class="rooms-grid">
            @foreach (var r in Model.Results)
            {
                <div class="room-card">
                    <div class="room-card-image">
                        @if (!string.IsNullOrWhiteSpace(r.ImageUrl))
                        {
                            <img src="@r.ImageUrl" alt="Phòng @r.RoomNumber" />
                        }
                        else
                        {
                            <div class="no-image">
                                <i class="fas fa-image"></i>
                                <span>Không có hình ảnh</span>
                            </div>
                        }
                        <div class="room-card-badge">
                            <i class="fas fa-check-circle"></i> Sẵn Sàng
                        </div>
                    </div>

                    <div class="room-card-body">
                        <div class="room-card-header">
                            <h3 class="room-number">Phòng @r.RoomNumber</h3>
                            <span class="room-type">@r.RoomTypeName</span>
                        </div>

                        <div class="room-card-info">
                            <div class="info-item">
                                <i class="fas fa-users"></i>
                                <span>Sức chứa: <strong>@r.MaxOccupancy</strong> khách</span>
                            </div>
                        </div>

                        <div class="room-card-price">
                            <span class="price-label">Giá / Đêm</span>
                            <span class="price-value">@r.PricePerNight.ToString("N0")<small>đ</small></span>
                        </div>

                        <div class="room-card-actions">
                            <a asp-controller="Rooms"
                               asp-action="Details"
                               asp-route-id="@r.RoomId"
                               asp-route-checkIn="@Model.CheckIn.ToString("yyyy-MM-dd")"
                               asp-route-checkOut="@Model.CheckOut.ToString("yyyy-MM-dd")"
                               class="btn-details">
                                <i class="fas fa-eye"></i> Chi Tiết
                            </a>

                            <a asp-controller="Bookings"
                               asp-action="Confirm"
                               asp-route-roomId="@r.RoomId"
                               asp-route-checkIn="@Model.CheckIn.ToString("yyyy-MM-dd")"
                               asp-route-checkOut="@Model.CheckOut.ToString("yyyy-MM-dd")"
                               class="btn-book">
                                <i class="fas fa-check-circle"></i> Đặt Ngay
                            </a>
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
}
else if (Context.Request.Method == "POST")
{
    <div class="alert alert-warning text-center mt-4">
        Không tìm thấy phòng phù hợp với tiêu chí của bạn. Vui lòng thử với ngày khác.
    </div>
}
else
{
    <div class="alert alert-info text-center mt-4">
        Vui lòng nhập ngày nhận phòng và ngày trả phòng rồi nhấn Tìm Kiếm.
    </div>
}

<style>
    body {
        background: #f5f5f5;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    .search-results-section {
        max-width: 1400px;
        margin: 40px auto;
        padding: 0 20px;
    }

    .results-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 3px solid #0066cc;
    }

    .results-title {
        font-size: 2rem;
        font-weight: 700;
        color: #0066cc;
        margin: 0;
        display: flex;
        align-items: center;
        gap: 15px;
    }

    .results-title i {
        color: #0066cc;
    }

    .results-count {
        background: #0066cc;
        color: white;
        padding: 10px 25px;
        border-radius: 25px;
        font-weight: 600;
        font-size: 1rem;
    }

    .rooms-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 30px;
        margin-top: 30px;
    }

    .room-card {
        background: white;
        border-radius: 20px;
        overflow: hidden;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
        border: 2px solid #e0e0e0;
        display: flex;
        flex-direction: column;
    }

    .room-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
        border-color: #0066cc;
    }

    .room-card-image {
        position: relative;
        width: 100%;
        height: 250px;
        overflow: hidden;
        background: #f0f0f0;
    }

    .room-card-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.3s ease;
    }

    .room-card:hover .room-card-image img {
        transform: scale(1.1);
    }

    .room-card-image .no-image {
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        color: #999;
        background: #f5f5f5;
    }

    .room-card-image .no-image i {
        font-size: 3rem;
        margin-bottom: 10px;
        opacity: 0.5;
    }

    .room-card-badge {
        position: absolute;
        top: 15px;
        right: 15px;
        background: rgba(46, 125, 50, 0.95);
        color: white;
        padding: 8px 15px;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 6px;
        backdrop-filter: blur(10px);
    }

    .room-card-badge i {
        font-size: 0.9rem;
    }

    .room-card-body {
        padding: 25px;
        flex: 1;
        display: flex;
        flex-direction: column;
    }

    .room-card-header {
        margin-bottom: 20px;
    }

    .room-number {
        font-size: 1.5rem;
        font-weight: 700;
        color: #0066cc;
        margin: 0 0 8px 0;
    }

    .room-type {
        display: inline-block;
        background: #f5f5f5;
        color: #666;
        padding: 5px 15px;
        border-radius: 15px;
        font-size: 0.9rem;
        font-weight: 500;
    }

    .room-card-info {
        margin-bottom: 20px;
    }

    .info-item {
        display: flex;
        align-items: center;
        gap: 10px;
        color: #666;
        font-size: 0.95rem;
        margin-bottom: 8px;
    }

    .info-item i {
        color: #0066cc;
        width: 20px;
        text-align: center;
    }

    .info-item strong {
        color: #0066cc;
    }

    .room-card-price {
        background: linear-gradient(135deg, #f5f5f5 0%, #e8e8e8 100%);
        padding: 20px;
        border-radius: 15px;
        margin-bottom: 20px;
        text-align: center;
        border: 2px solid #e0e0e0;
    }

    .price-label {
        display: block;
        font-size: 0.85rem;
        color: #666;
        text-transform: uppercase;
        letter-spacing: 1px;
        margin-bottom: 8px;
        font-weight: 600;
    }

    .price-value {
        display: block;
        font-size: 1.8rem;
        font-weight: 700;
        color: #0066cc;
    }

    .price-value small {
        font-size: 1rem;
        color: #999;
        font-weight: 400;
    }

    .room-card-actions {
        display: flex;
        gap: 12px;
        margin-top: auto;
    }

    .btn-details,
    .btn-book {
        flex: 1;
        padding: 12px 20px;
        border-radius: 50px;
        font-weight: 600;
        text-decoration: none;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        transition: all 0.3s ease;
        font-size: 0.95rem;
        border: 2px solid;
    }

    .btn-details {
        background: white;
        color: #0066cc;
        border-color: #0066cc;
    }

    .btn-details:hover {
        background: #0066cc;
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    .btn-book {
        background: #0066cc;
        color: white;
        border-color: #0066cc;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    .btn-book:hover {
        background: #0052a3;
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        color: white;
    }   
</style>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}
